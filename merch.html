<!-- /merch.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Dead Gravel — Merch</title>
  <meta name="description" content="Dead Gravel — Merch" />

  <!-- Icons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/icons/favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/icons/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0b0f12" />

  <!-- SOCIAL PREVIEW (match other pages) -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Dead Gravel">
  <meta property="og:title" content="Dead Gravel — Merch">
  <meta property="og:description" content="Official Dead Gravel merchandise. Shirts, posters & more.">
  <meta property="og:url" content="https://deadgravel.com/merch.html">
  <meta property="og:image" content="https://deadgravel.com/thumb.jpg">
  <meta property="og:image:secure_url" content="https://deadgravel.com/thumb.jpg">
  <meta property="og:image:alt" content="Dead Gravel — promo thumbnail">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@DeadGravel77">
  <meta name="twitter:creator" content="@DeadGravel77">
  <meta name="twitter:title" content="Dead Gravel — Merch">
  <meta name="twitter:description" content="Official Dead Gravel merchandise. Shirts, posters & more.">
  <meta name="twitter:image" content="https://deadgravel.com/thumb.jpg">

  <!-- Perf: fonts & bg -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="image" href="bg4.webp" imagesizes="100vw">
  <!-- Optional: speed up PayPal SDK -->
  <link rel="preconnect" href="https://www.paypal.com" crossorigin>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Gloock&family=Six+Caps&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-dark:#0a0a0a;
      --ink:#e8e8e8;
      --ink-dim:#b8c0cc;
      --brand-blue:#3939f1;
      --maxw:1200px;
      --safe-top: env(safe-area-inset-top, 0px);
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    html{
      scroll-behavior:smooth;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
      overflow-x:hidden;
    }

    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;
      color:var(--ink);
      background:var(--bg-dark) url('bg4.webp') center / cover no-repeat fixed;
    }
    @media (max-width: 900px){
      body{ background-attachment: scroll; }
    }

    /* Overlay */
    .bg-shade{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      opacity: 0; transition: opacity .12s linear;
      background:
        radial-gradient(120% 120% at 50% 20%, rgba(0,0,0,.0) 0%, rgba(0,0,0,.35) 60%, rgba(0,0,0,.6) 100%),
        linear-gradient(to bottom, rgba(0,0,0,.0) 0%, rgba(0,0,0,.45) 100%);
    }
    main{ position:relative; z-index:1; }

    /* Desktop/Tablet Nav */
    .top-links{
      position:fixed; top: calc(8px + var(--safe-top)); left:0; right:0;
      display:flex; gap:28px; justify-content:center;
      padding-inline:12px;
      z-index:10000;
      transition:transform .28s ease, opacity .28s ease;
      will-change:transform, opacity;
      pointer-events:auto;
    }
    .top-links.hide{ transform:translateY(-140%); opacity:0; }
    .top-links a,
    .top-links a:link,
    .top-links a:visited{
      color:var(--ink) !important;
      text-decoration:none;
      font-family:"Six Caps",sans-serif;
      letter-spacing:.16em; text-transform:uppercase;
      font-size:clamp(1.5rem, 4vw, 2.4rem);
      line-height:1;
      padding:.25rem .35rem;
      border-radius:.25rem;
      opacity:.95; transition:color .2s ease, opacity .2s ease, background .2s ease;
    }
    .top-links a:hover,
    .top-links a:focus,
    .top-links a:focus-visible{
      color:var(--brand-blue) !important;
      background:transparent; opacity:1; outline:none;
    }
    .top-links a[aria-current="page"]{ color:var(--brand-blue) !important; }

    /* Hamburger & Mobile menu */
    .hamburger{ display:none; }
    .mobile-menu{ display:none; }

    @media (max-width:640px){
      .top-links{ display:none; }

      .hamburger{
        position:fixed; top: calc(10px + var(--safe-top)); right: 10px;
        z-index: 10010; display: inline-flex; align-items: center; justify-content: center;
        width: 44px; height: 44px; border-radius: 10px;
        border: 1px solid #ffffff22;
        background: rgba(10,10,10,.55);
        -webkit-backdrop-filter: blur(6px) saturate(140%);
        backdrop-filter: blur(6px) saturate(140%);
        color: var(--ink); cursor: pointer;
      }
      .hamburger:focus-visible{ outline:2px solid var(--brand-blue); outline-offset:2px; }
      .hamburger svg{ width: 26px; height: 26px; }

      .mobile-menu{
        position: fixed; top: 0; left: 0; right: 0;
        padding-top: calc(14px + var(--safe-top)); padding-bottom: 14px;
        z-index: 10005; display: grid; gap: 10px; justify-items: center;
        background: rgba(10,10,10,.78);
        -webkit-backdrop-filter: blur(10px) saturate(150%);
        backdrop-filter: blur(10px) saturate(150%);
        border-bottom: 1px solid #ffffff22;
        transform: translateY(-120%); opacity: 0; transition: transform .24s ease, opacity .24s ease;
      }
      .mobile-menu.open{ transform: translateY(0); opacity: 1; }
      .mobile-menu[hidden]{ display:none !important; }

      .mobile-menu a{
        color: var(--ink); text-decoration: none;
        font-family:"Six Caps",sans-serif; letter-spacing:.16em; text-transform:uppercase;
        font-size: clamp(1.25rem, 6vw, 1.8rem); padding: .4rem .6rem; border-radius: .35rem;
      }

      .top-pad{ height: 90px; }
    }

    .top-pad{ height:56px; }

    /* Sections */
    section{
      min-height:auto; display:grid; place-items:center; text-align:center;
      padding:96px 20px 72px; position:relative; isolation:isolate;
    }
    .section-inner{ width:min(100%, var(--maxw)); }
    .backdrop-none{ backdrop-filter:none !important; }

    h2{ font-family:"Gloock",serif; font-weight:400; font-size:clamp(2rem, 4vw, 3.2rem); margin:0 0 16px; }
    .brand{ color: var(--brand-blue); }
    .kicker{
      font-family:"Six Caps", sans-serif; letter-spacing:.16em; text-transform:uppercase;
      font-size:clamp(1.7rem, 2.4vw, 1.4rem); color:var(--ink-dim); margin:0 0 10px;
    }
    .rule{ width:72px; height:2px; background:#ffffff30; margin:10px 0 20px; }

    /* Merch grid */
    .grid-merch{
      display:grid; gap:18px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      align-items:stretch; text-align:left;
    }
    .product-card{
      position:relative; padding:16px;
      background:#0b0f16cc; border:1px solid #ffffff22; border-radius:16px;
      box-shadow:0 12px 40px #000a; overflow:hidden;
    }
    .product-card::before,.product-card::after{
      content:""; position:absolute; width:20px; height:20px; border:1px solid #ffffff44;
    }
    .product-card::before{ top:8px; left:8px; border-right:none; border-bottom:none; }
    .product-card::after{ bottom:8px; right:8px; border-left:none; border-top:none; }
    .product-media{
      width:100%; height:auto; aspect-ratio:1/1; object-fit:cover;
      border-radius:12px; border:1px solid #ffffff22; display:block; margin-bottom:12px;
    }
    .product-title{ font-weight:700; font-size:1.1rem; margin:0 0 4px; color:var(--ink); }
    .product-desc{ color:var(--ink-dim); font-size:.98rem; margin:0 0 10px; }
    .product-price{ color:#fff; font-weight:700; margin:0 0 12px; }

    .btn-row{ display:flex; flex-wrap:wrap; gap:10px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer; padding:12px 14px; min-height:44px;
      border-radius:999px; border:1px solid #ffffff30;
      background:#0e141d; color:var(--ink); text-decoration:none;
      font-weight:700; letter-spacing:.06em; text-transform:uppercase; font-size:.8rem;
      transition:transform .15s ease, box-shadow .15s ease, color .2s ease, border-color .2s ease;
    }
    .btn:hover{ box-shadow:0 6px 24px #0008; transform:translateY(-1px); }
    .btn.btn-outline{ background:transparent; border-color:#ffffff40; }
    .btn.btn-outline:hover{ border-color:#3939f1; color:#3939f1; }

    /* PayPal button holder */
    .paypal-holder{ width:100%; margin-top:8px; }
    .paypal-holder > div{ max-width: 320px; }

    /* Gelato modal */
    .gelato-modal{
      position:fixed; inset:0; z-index:20000; display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.6); backdrop-filter: blur(4px) saturate(120%);
      padding:20px;
    }
    .gelato-modal.open{ display:flex; }
    .gelato-dialog{
      width:min(100%, 980px); height:min(85vh, 760px);
      background:#0a0f14; border:1px solid #ffffff22; border-radius:16px;
      box-shadow:0 18px 60px #000c; position:relative; overflow:hidden;
      display:grid; grid-template-rows: 48px 1fr;
    }
    .gelato-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px; border-bottom:1px solid #ffffff22;
      color:var(--ink); font-weight:700; letter-spacing:.06em; text-transform:uppercase;
      background:linear-gradient(180deg, #0b0f16, #0b0f16cc);
    }
    .gelato-close{
      appearance:none; border:1px solid #ffffff33; background:#0e141d; color:var(--ink);
      border-radius:999px; padding:8px 12px; cursor:pointer; font-weight:700;
    }
    .gelato-frame{ width:100%; height:100%; border:0; background:#111; }

    /* Payment badges layout */
    .pay-methods {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem .75rem;
      justify-content: center;
      align-items: center;
      margin-top: .5rem;
      padding: 0 .5rem;
    }
    .pay-badge { width: 96px; height: 30px; flex: 0 0 auto; }
    .pay-badge .badge-bg { fill: currentColor; opacity: 0.08; }
    .pay-badge .badge-text {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-size: 12px; font-weight: 600; fill: currentColor;
    }
    .pay-methods { color: inherit; opacity: 0.9; }
    .pay-badge { transition: transform .12s ease, opacity .12s ease; }
    .pay-badge:where(:hover,:focus) { transform: translateY(-1px); opacity: 1; outline: none; }
    @media (max-width: 480px) {
      .pay-badge { width: 84px; height: 28px; }
      .pay-methods { gap: .4rem .5rem; }
    }
    @media (prefers-contrast: more) {
      .pay-badge .badge-bg { opacity: 0.16; }
      .pay-badge .badge-text { font-weight: 700; }
    }

    /* Gravilhas */
    #gravilhas .section-inner{ backdrop-filter:none !important; }
    .gravilhas{
      width: clamp(160px, 18vw, 260px);
      height:auto; display:block; margin: 6px auto 0;
      border:none; box-shadow:none; border-radius:0; filter:none; opacity:.95;
    }
    .link-wrap { position: relative; }
    .full-link { position: absolute; inset: 0; display: block; }

    /* Footer */
    footer{ background:none; border:0; padding:28px 16px 48px; text-align:center; }
    .rights{ color:var(--ink-dim); font-weight:500; letter-spacing:.04em; font-size:clamp(1rem, 1.6vw, 1.1rem); margin-top:6px; }
    .socials{ display:flex; gap:18px; justify-content:center; align-items:center; margin:12px 0 0; flex-wrap:wrap; }
    .socials a{ display:inline-grid; place-items:center; color:#3939f1; }
    .socials a:hover{ opacity:.85; }
    .socials svg{ width:56px; height:56px; }

    @media (prefers-reduced-motion: reduce){
      .top-links{ transition:none; }
      .bg-shade{ transition:none; }
      .btn, .btn:hover{ transition:none; transform:none; box-shadow:none; }
    }
  </style>
</head>
<body>
  <!-- Overlay -->
  <div class="bg-shade" id="bgShade" aria-hidden="true"></div>

  <!-- DESKTOP/TABLET NAV -->
  <nav class="top-links" id="topLinks" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="index.html#shows">Shows</a>
    <a href="bio.html">Bio</a>
    <a href="merch.html" aria-current="page">Merch</a>
    <a href="mailto:deadgravell77@gmail.com">Contact</a>
  </nav>

  <!-- MOBILE: Hamburger + panel -->
  <button class="hamburger" id="menuBtn" type="button" aria-label="Open menu" aria-controls="mobileMenu" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>
  <div class="mobile-menu" id="mobileMenu" role="navigation" aria-label="Mobile primary" hidden>
    <a href="index.html">Home</a>
    <a href="index.html#shows">Shows</a>
    <a href="bio.html">Bio</a>
    <a href="merch.html" aria-current="page">Merch</a>
    <a href="mailto:deadgravell77@gmail.com">Contact</a>
  </div>

  <main>
    <div class="top-pad" aria-hidden="true"></div>

    <!-- MERCH HEADER -->
    <section id="header">
      <div class="section-inner backdrop-none">
        <div class="kicker">Official Store</div>
        <h2 class="brand">Dead Gravel Merch</h2>
        <div class="rule"></div>

        <p class="product-desc" style="text-align:center; margin-inline:auto; max-width:60ch;">
          All items are made to order to reduce waste and our carbon footprint. Fulfilled globally via <strong>Gelato</strong>.
          Pay with <strong>Stripe</strong> (cards, Apple&nbsp;Pay, Google&nbsp;Pay), <strong>MB&nbsp;WAY</strong>, <strong>PayPal</strong>, and other local methods.
        </p>

        <!-- Payment methods (inline SVG) -->
        <div class="pay-methods" aria-label="Accepted payment methods">
          <!-- Stripe -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="Stripe">
            <title>Stripe</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">Stripe</text>
          </svg>
          <!-- MB WAY -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="MB WAY">
            <title>MB WAY</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">MB&nbsp;WAY</text>
          </svg>
          <!-- PayPal -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="PayPal">
            <title>PayPal</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">PayPal</text>
          </svg>
          <!-- Visa -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="Visa">
            <title>Visa</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">Visa</text>
          </svg>
          <!-- Mastercard -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="Mastercard">
            <title>Mastercard</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">Mastercard</text>
          </svg>
          <!-- Apple Pay -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="Apple Pay">
            <title>Apple Pay</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">Apple&nbsp;Pay</text>
          </svg>
          <!-- Google Pay -->
          <svg class="pay-badge" viewBox="0 0 120 36" role="img" aria-label="Google Pay">
            <title>Google Pay</title>
            <rect x="0" y="0" width="120" height="36" rx="6" class="badge-bg"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="badge-text">Google&nbsp;Pay</text>
          </svg>
        </div>
      </div>
    </section>

    <!-- MERCH GRID -->
    <section id="merch">
      <div class="section-inner grid-merch">
        <!-- Product 1 -->
        <article class="product-card"
                 data-id="tee-mad"
                 data-name="Band Logo Shirt"
                 data-price="21.99"
                 data-currency="EUR"
                 data-gelato-url="https://example.gelato.com/product/tee-mutually-assured-drip">
          <img src="merch1.jpg" alt="Band Logo Shirt" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Band Logo Shirt</h3>
          <p class="product-desc">Premium cotton, unisex. Sizes S–XXL.</p>
          <div class="product-price">€21.99</div>
          <div class="btn-row">
            <button class="btn" data-action="gelato" type="button">Customize &amp; Order (Gelato)</button>
          </div>
          <div class="paypal-holder" id="pp-tee-mad"></div>
        </article>

        <!-- Product 2 -->
        <article class="product-card"
                 data-id="ls-bunker"
                 data-name="Girlie Band Shirt"
                 data-price="21.99"
                 data-currency="EUR"
                 data-gelato-url="https://example.gelato.com/product/longsleeve-bunker-syndrome">
          <img src="merch2.jpg" alt="Girlie Band Shirt" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Girlie Band Shirt</h3>
          <p class="product-desc">Soft cotton, tapered fit. Sizes S–XXL.</p>
          <div class="product-price">€21.99</div>
          <div class="btn-row">
            <button class="btn" data-action="gelato" type="button">Customize &amp; Order (Gelato)</button>
          </div>
          <div class="paypal-holder" id="pp-ls-bunker"></div>
        </article>

        <!-- Product 3 -->
        <article class="product-card"
                 data-id="poster-a2"
                 data-name="Longsleeve Shirt"
                 data-price="29.99"
                 data-currency="EUR"
                 data-gelato-url="https://example.gelato.com/product/poster-a2-dustborn">
          <img src="merch3.jpg" alt="Longsleeve Shirt" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Longsleeve Shirt</h3>
          <p class="product-desc">Soft heavyweight cotton, ribbed cuffs. Sizes S–XXL.</p>
          <div class="product-price">€29.99</div>
          <div class="btn-row">
            <button class="btn" data-action="gelato" type="button">Customize &amp; Order (Gelato)</button>
          </div>
          <div class="paypal-holder" id="pp-poster-a2"></div>
        </article>
      </div>
    </section>

    <!-- Gravilhas -->
    <section id="gravilhas" class="link-wrap">
      <div class="section-inner backdrop-none">
        <img src="gravilhas4.svg" alt="gravilhas" class="gravilhas" loading="lazy" decoding="async" />
        <a class="full-link" href="index.html" aria-label="Go to homepage"></a>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="rights">© <span id="year"></span> Dead Gravel — All rights reserved.</div>

      <div class="socials" role="list" aria-label="Social links">
        <a aria-label="Instagram" href="https://instagram.com/deadgravel77" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor"/>
            <circle cx="12" cy="12" r="4" stroke="currentColor"/>
            <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="Bandcamp" href="https://deadgravel.bandcamp.com/track/ruin-my-fun" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 17l5.5-10H21l-5.5 10H3z" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="YouTube" href="https://www.youtube.com/@DeadGravel77" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor"/>
            <path d="M10 9.5l5 2.5-5 2.5v-5z" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="Spotify" href="#" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="9" stroke="currentColor"/>
            <path d="M7 10c3-.6 7-.4 10 1M7.5 13c2.6-.4 5.8-.1 8 .9M7.8 15.8c1.9-.3 3.9 0 5.6 .7" stroke="currentColor" stroke-linecap="round"/>
          </svg>
        </a>
      </div>
    </footer>
  </main>

  <!-- PayPal SDK (replace PAYPAL_CLIENT_ID) -->
  <script src="https://www.paypal.com/sdk/js?client-id=PAYPAL_CLIENT_ID&currency=EUR" data-sdk-integration-source="button-factory" defer></script>

  <script>
    // Year
    (function(){
      const y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();
    })();

    // Scroll effects (match site behavior)
    (function initScrollEffects(){
      const shade = document.getElementById('bgShade');
      const nav   = document.getElementById('topLinks');
      if (!shade || !nav) return;

      const mqMobileNav = window.matchMedia('(max-width: 640px)');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const maxOpacity = 0.75;
      const rampPx = 220;

      let ticking = false;

      function apply(){
        const y = window.scrollY || 0;

        if (!prefersReduced) {
          const t = Math.min(1, y / rampPx);
          shade.style.opacity = (t * maxOpacity).toFixed(3);
        } else {
          shade.style.opacity = y > 0 ? '0.5' : '0';
        }

        if (mqMobileNav.matches) nav.classList.remove('hide');
        else nav.classList.toggle('hide', y > 40);

        ticking = false;
      }

      function onScroll(){
        if (!ticking) {
          ticking = true;
          requestAnimationFrame(apply);
        }
      }

      apply();
      window.addEventListener('scroll', onScroll, { passive:true });
      window.addEventListener('resize', apply, { passive:true });
      mqMobileNav.addEventListener?.('change', apply);
    })();

    // Mobile hamburger (+ body lock)
    (function(){
      const btn  = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;

      const lock = (on) => {
        document.body.style.overflow = on ? 'hidden' : '';
        document.body.style.touchAction = on ? 'none' : '';
      };
      const open = () => {
        menu.hidden = false;
        void menu.offsetHeight;               // ensure transition
        menu.classList.add('open');
        btn.setAttribute('aria-expanded','true');
        btn.setAttribute('aria-label','Close menu');
        lock(true);
      };
      const close = () => {
        menu.classList.remove('open');
        btn.setAttribute('aria-expanded','false');
        btn.setAttribute('aria-label','Open menu');
        lock(false);
        setTimeout(() => {
          if (!menu.classList.contains('open')) menu.hidden = true;
        }, 260);
      };

      btn.addEventListener('click', () => (menu.classList.contains('open') ? close() : open()));
      menu.addEventListener('click', (e) => { if (e.target.closest('a')) close(); });
      window.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
      window.addEventListener('resize', () => {
        if (!window.matchMedia('(max-width: 640px)').matches) close();
      }, { passive:true });
    })();

    // Gelato modal logic (opens product URL in iframe)
    (function(){
      const modal = document.createElement('div');
      modal.className = 'gelato-modal';
      modal.innerHTML = `
        <div class="gelato-dialog" role="dialog" aria-modal="true" aria-label="Gelato product">
          <div class="gelato-header">
            <span>Gelato — Order & Customize</span>
            <button class="gelato-close" type="button">Close</button>
          </div>
          <iframe class="gelato-frame" src="about:blank" title="Gelato" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      `;
      document.body.appendChild(modal);

      const frame = modal.querySelector('.gelato-frame');
      const closeBtn = modal.querySelector('.gelato-close');

      function open(url){
        frame.src = url;
        modal.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
      function close(){
        modal.classList.remove('open');
        frame.src = 'about:blank';
        document.body.style.overflow = '';
      }

      closeBtn.addEventListener('click', close);
      modal.addEventListener('click', (e)=>{ if (e.target === modal) close(); });
      window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') close(); });

      document.querySelectorAll('[data-action="gelato"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const card = e.target.closest('.product-card');
          const url = card?.dataset.gelatoUrl;
          if (url) open(url);
          else alert('Missing Gelato product URL for this item.');
        });
      });
    })();

    // PayPal buttons for each product card
    (function initPayPal(){
      function setup(){
        document.querySelectorAll('.product-card').forEach(card => {
          const id = card.dataset.id;
          const name = card.dataset.name;
          const price = card.dataset.price;
          const currency = card.dataset.currency || 'EUR';
          const holderId = 'pp-' + id;
          const holder = document.getElementById(holderId);
          if (!holder) return;

          try {
            window.paypal.Buttons({
              style: { layout: 'horizontal', tagline: false, height: 40, shape: 'pill' },
              createOrder: function(data, actions) {
                return actions.order.create({
                  purchase_units: [{
                    description: name,
                    amount: { currency_code: currency, value: price }
                  }]
                });
              },
              onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                  alert('Thanks, ' + (details.payer.name?.given_name || 'friend') + '! Your order for ' + name + ' is confirmed.');
                });
              },
              onError: function(err) {
                console.error('PayPal error:', err);
                alert('Payment error. Please try again or use the Gelato option.');
              }
            }).render('#' + holderId);
          } catch (e) {
            console.error('PayPal render failed:', e);
          }
        });
      }

      if (window.paypal) setup();
      else window.addEventListener('load', () => { if (window.paypal) setup(); });
    })();
  </script>
</body>
</html>
