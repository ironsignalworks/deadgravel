<!-- /merch.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Dead Gravel â€” Merch</title>
  <meta name="description" content="Dead Gravel â€” Merch" />

  <!-- Icons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/icons/favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/icons/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0b0f12" />

  <!-- Social -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Dead Gravel">
  <meta property="og:title" content="Dead Gravel â€” Merch">
  <meta property="og:description" content="Official Dead Gravel merchandise. Shirts, posters & more.">
  <meta property="og:url" content="https://deadgravel.com/merch.html">
  <meta property="og:image" content="https://deadgravel.com/thumb.jpg">
  <meta property="og:image:secure_url" content="https://deadgravel.com/thumb.jpg">
  <meta property="og:image:alt" content="Dead Gravel â€” promo thumbnail">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@DeadGravel77">
  <meta name="twitter:creator" content="@DeadGravel77">
  <meta name="twitter:title" content="Dead Gravel â€” Merch">
  <meta name="twitter:description" content="Official Dead Gravel merchandise. Shirts, posters & more">
  <meta name="twitter:image" content="https://deadgravel.com/thumb.jpg">

  <!-- Perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="image" href="bg4.webp" imagesizes="100vw">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Gloock&family=Six+Caps&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- EmailJS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // EmailJS keys/IDs
    const EMAILJS_PUBLIC_KEY = "h6bYFekvxZKkFmv63";
    const EMAILJS_SERVICE_ID = "service_6rj9urt";
    const EMAILJS_TEMPLATE_TO_SELLER = "template_seller"; // sends only to you pre-checkout
    document.addEventListener('DOMContentLoaded', () => {
      try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch(e){ console.error('EmailJS init failed', e); }
    });

    // ðŸ”’ Global kill-switch: disable the store without touching product data
    const STORE_DISABLED = true;
  </script>

  <style>
    :root{
      --bg-dark:#0a0a0a;
      --ink:#e8e8e8;
      --ink-dim:#b8c0cc;
      --brand-blue:#3939f1;
      --maxw:1200px;
      --safe-top: env(safe-area-inset-top, 0px);
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    html{ scroll-behavior:smooth; -webkit-text-size-adjust:100%; text-size-adjust:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;
      color:var(--ink);
      background:var(--bg-dark) url('bg4.webp') center / cover no-repeat fixed;
    }
    @media (max-width:900px){ body{ background-attachment:scroll; } }

    .bg-shade{ position:fixed; inset:0; z-index:0; pointer-events:none; opacity:0; transition:opacity .12s linear;
      background: radial-gradient(120% 120% at 50% 20%, rgba(0,0,0,.0) 0%, rgba(0,0,0,.35) 60%, rgba(0,0,0,.6) 100%),
                  linear-gradient(to bottom, rgba(0,0,0,.0) 0%, rgba(0,0,0,.45) 100%); }
    main{ position:relative; z-index:1; }

    /* Nav */
    .top-links{
      position:fixed; top: calc(8px + var(--safe-top)); left:0; right:0;
      display:flex; gap:28px; justify-content:center; padding-inline:12px;
      z-index:10000; transition:transform .28s ease, opacity .28s ease;
    }
    .top-links.hide{ transform:translateY(-140%); opacity:0; }
    .top-links a{
      color:var(--ink) !important; text-decoration:none;
      font-family:"Six Caps",sans-serif; letter-spacing:.16em; text-transform:uppercase;
      font-size:clamp(1.5rem,4vw,2.4rem); line-height:1;
      padding:.25rem .35rem; border-radius:.25rem; opacity:.95;
      transition:color .2s ease, opacity .2s ease, background .2s ease;
    }
    .top-links a:hover{ color:var(--brand-blue) !important; }

    .hamburger{ display:none; }
    .mobile-menu{ display:none; }

    @media (max-width:640px){
      .top-links{ display:none; }
      .hamburger{
        position:fixed; top: calc(10px + var(--safe-top)); right:10px; z-index:10010;
        display:inline-flex; align-items:center; justify-content:center;
        width:44px; height:44px; border-radius:10px; border:1px solid #ffffff22;
        background:rgba(10,10,10,.55);
      }
      .hamburger:focus-visible{ outline:2px solid #3939f1; outline-offset:2px; }
      .hamburger svg{ width:26px; height:26px; }
      .mobile-menu{
        position:fixed; top:0; left:0; right:0;
        padding-top: calc(14px + var(--safe-top)); padding-bottom:14px;
        z-index:10005; display:grid; gap:10px; justify-items:center;
        background: rgba(10,10,10,.78); -webkit-backdrop-filter: blur(10px) saturate(150%); backdrop-filter: blur(10px) saturate(150%);
        border-bottom:1px solid #ffffff22;
        transform:translateY(-120%); opacity:0; transition:transform .24s ease, opacity .24s ease;
      }
      .mobile-menu.open{ transform:translateY(0); opacity:1; }
      .mobile-menu[hidden]{ display:none !important; }
      .mobile-menu a{
        color: var(--ink); text-decoration: none;
        font-family:"Six Caps",sans-serif; letter-spacing:.16em; text-transform:uppercase;
        font-size: clamp(1.25rem,6vw,1.8rem); padding:.4rem .6rem; border-radius:.35rem;
      }
      .top-pad{ height:90px; }
    }
    .top-pad{ height:56px; }

    /* Sections */
    section{ display:grid; place-items:center; text-align:center; padding:96px 20px 72px; position:relative; }
    .section-inner{ width:min(100%, var(--maxw)); }
    .backdrop-none{ backdrop-filter:none !important; }

    h2{ font-family:"Gloock",serif; font-weight:400; font-size:clamp(2rem,4vw,3.2rem); margin:0 0 16px; }
    .brand{ color: var(--brand-blue); }
    .kicker{ font-family:"Six Caps", sans-serif; letter-spacing:.16em; text-transform:uppercase; font-size:clamp(1.7rem,2.4vw,1.4rem); color:var(--ink-dim); margin:0 0 10px; }
    .rule{ width:72px; height:2px; background:#ffffff30; margin:10px 0 20px; }

    /* Merch grid */
    .grid-merch{
      display:grid; gap:18px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      align-items:stretch; text-align:left;
    }
    .product-card{
      position:relative; padding:16px;
      background:#0b0f16cc; border:1px solid #ffffff22; border-radius:16px;
      box-shadow:0 12px 40px #000a; overflow:hidden;
    }
    .product-card::before,.product-card::after{
      content:""; position:absolute; width:20px; height:20px; border:1px solid #ffffff44;
    }
    .product-card::before{ top:8px; left:8px; border-right:none; border-bottom:none; }
    .product-card::after{ bottom:8px; right:8px; border-left:none; border-top:none; }
    .product-media{
      width:100%; aspect-ratio:1/1; object-fit:cover;
      border-radius:12px; border:1px solid #ffffff22; display:block; margin-bottom:12px; cursor:pointer;
    }
    .product-title{ font-weight:700; font-size:1.1rem; margin:0 0 4px; color:var(--ink); }
    .product-desc{ color:var(--ink-dim); font-size:.98rem; margin:0 0 10px; }
    .product-price{ color:#fff; font-weight:700; margin:0 0 12px; }

    .btn-row{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer; padding:12px 14px; min-height:44px; width:100%;
      border-radius:999px; border:1px solid #ffffff30;
      background:#0e141d; color:var(--ink); text-decoration:none;
      font-weight:700; letter-spacing:.06em; text-transform:uppercase; font-size:.9rem;
      transition:transform .15s ease, box-shadow .15s ease, color .2s ease, border-color .2s ease;
    }
    .btn:hover{ box-shadow:0 6px 24px #0008; transform:translateY(-1px); }
    .btn.btn-primary{ border-color:#5a67f3aa; }
    .btn.btn-primary:hover{ border-color:#3939f1; color:#eaeaff; }

    /* Inputs (size) */
    .ship-input{
      background:#0e141d; color:var(--ink); border:1px solid #ffffff2a; border-radius:10px;
      padding:10px 12px; font:inherit; outline:none; width:100%;
    }
    .ship-input:focus{ border-color:#3939f1; box-shadow:0 0 0 3px #3939f124; }
    .help-note{ color:var(--ink-dim); font-size:.85rem; margin-top:4px; }
    .oos{ opacity:.6; }

    /* Inline swatches */
    .color-inline{ margin:6px 0 4px; }
    .color-label-inline{ display:block; font-weight:700; margin-bottom:6px; color:var(--ink); }
    .swatch-row-inline{ display:flex; flex-wrap:wrap; gap:8px; }
    .swatch-btn{
      display:inline-flex; align-items:center; gap:8px; cursor:pointer;
      padding:8px 12px; border-radius:999px; border:1px solid #ffffff2a; background:#0e141d; color:var(--ink);
      font-weight:700; letter-spacing:.02em;
    }
    .swatch-btn[data-selected="true"]{ border-color:#3939f1; box-shadow:0 0 0 3px #3939f124; }

    /* Modal (swatches + zoom) â€” fixed height & scroll */
    .modal{
      position:fixed; inset:0; z-index:20000;
      display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.6); backdrop-filter: blur(6px) saturate(130%);
      padding:12px;
      overscroll-behavior: contain;
      touch-action: none;
    }
    .modal.open{ display:flex; }

    .modal-dialog{
      width:min(100%, 820px);
      max-height: min(92dvh, 760px);
      background:#0b0f16; border:1px solid #ffffff22; border-radius:16px;
      box-shadow:0 20px 60px #000c; overflow:hidden;
      display:grid; grid-template-rows:auto 1fr auto;
      overscroll-behavior: contain;
      touch-action: none;
    }

    .modal-header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px; border-bottom:1px solid #ffffff22;
      background:linear-gradient(180deg,#0c1118,#0b0f16);
    }
    .modal-title{ font-weight:800; letter-spacing:.06em; text-transform:uppercase; color:var(--ink); }
    .modal-close{ appearance:none; border:1px solid #ffffff33; background:#0e141d; color:var(--ink);
      border-radius:999px; padding:8px 12px; cursor:pointer; font-weight:700; }

    .modal-body{
      overflow:auto;
      padding:14px;
      display:grid; grid-template-columns: 1.2fr .8fr; gap:14px;
      align-items:start;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }

    .modal-preview{
      position:relative; overflow:hidden; border-radius:12px; border:1px solid #ffffff22;
      max-height: 58dvh;
      overscroll-behavior: contain;
      touch-action: none; /* critical for mobile panning */
    }
    .modal-preview img{
      width:100%; height:100%; object-fit:contain; display:block;
      aspect-ratio:auto;
      cursor: zoom-in; transform-origin: 50% 50%; user-select:none;
      touch-action: none; /* prevent scroll while panning */
    }
    .modal-preview img.zoomed{ cursor: grab; }

    .color-group{ text-align:left; }
    .color-label{ font-weight:700; margin-bottom:8px; display:block; color:var(--ink); }
    .swatch-row{ display:flex; flex-wrap:wrap; gap:8px; }
    .swatch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; padding:8px 12px;
      border-radius:999px; border:1px solid #ffffff2a; background:#0e141d; color:var(--ink);
      font-weight:700; letter-spacing:.02em; }
    .swatch[data-selected="true"]{ border-color:#3939f1; box-shadow:0 0 0 3px #3939f124; }

    .modal-footer{
      display:flex; justify-content:flex-end; gap:10px; padding:10px 12px; border-top:1px solid #ffffff22;
    }
    .btn-secondary{ border-color:#ffffff2a; background:#0e141d; }
    .btn-secondary:hover{ border-color:#777; }

    @media (max-width:760px){
      .modal-body{ grid-template-columns: 1fr; gap:12px; padding:12px; }
      .modal-preview{ max-height: 66dvh; }
    }

    /* Gravilhas */
    #gravilhas .section-inner{ backdrop-filter:none !important; }
    .gravilhas{
      width: clamp(160px, 18vw, 260px);
      height: auto;
      display:block;
      margin: 6px auto 0;
      border:none; box-shadow:none; border-radius:0; filter:none; opacity:.95;
      max-width: 100%;
    }
    .link-wrap { position: relative; }
    .full-link { position: absolute; inset: 0; display: block; }

    /* Footer */
    footer{ background:none; border:0; padding:28px 16px 48px; text-align:center; }
    .rights{ color:var(--ink-dim); font-weight:500; letter-spacing:.04em; font-size:clamp(1rem, 1.6vw, 1.1rem); margin-top:6px; }
    .socials{ display:flex; gap:18px; justify-content:center; align-items:center; margin:12px 0 0; flex-wrap:wrap; }
    .socials a{ display:inline-grid; place-items:center; color:#3939f1; }
    .socials a:hover{ opacity:.85; }
    .socials svg{ width:56px; height:56px; }

    @media (prefers-reduced-motion: reduce){
      .top-links{ transition:none; }
      .bg-shade{ transition:none; }
      .btn, .btn:hover{ transition:none; transform:none; box-shadow:none; }
    }

    /* ðŸ”’ Disabled store styles */
    .store-disabled .product-card::after{ /* keep corner deco */ }
    .store-disabled .product-media,
    .store-disabled .swatch-row-inline,
    .store-disabled .size-slot select{
      pointer-events:none;
      opacity:.6;
      filter:grayscale(25%);
    }
    .store-disabled .btn.btn-primary{
      pointer-events:none;
      cursor:not-allowed;
      opacity:.6;
      border-color:#ffffff22;
    }
    .disabled-cover{
      position:absolute; inset:0; background:linear-gradient(180deg, #0b0f16cc, #0b0f16aa);
      display:grid; place-items:end center; padding:12px; text-align:center;
      pointer-events:none;
    }
    .disabled-chip{
      display:inline-block; padding:8px 12px; border-radius:999px;
      background:#161c27; border:1px solid #ffffff33; font-weight:800; letter-spacing:.06em;
      text-transform:uppercase; color:#e8e8e8;
    }
    .coming-soon{
      margin-top:-12px;
      padding:16px;
      border:1px solid #ffffff22;
      background:#0b0f16cc;
      border-radius:14px;
      text-align:center;
    }
    .coming-soon strong{ color:#e8e8e8; }
    .coming-soon .sub{ color:var(--ink-dim); margin-top:6px; }
  </style>
</head>
<body>
  <div class="bg-shade" id="bgShade" aria-hidden="true"></div>

  <nav class="top-links" id="topLinks" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="index.html#shows">Shows</a>
    <a href="bio.html">Bio</a>
    <a href="merch.html" aria-current="page">Merch</a>
    <a href="mailto:deadgravell77@gmail.com">Contact</a>
  </nav>

  <button class="hamburger" id="menuBtn" type="button" aria-label="Open menu" aria-controls="mobileMenu" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>
  <div class="mobile-menu" id="mobileMenu" role="navigation" aria-label="Mobile primary" hidden>
    <a href="index.html">Home</a>
    <a href="index.html#shows">Shows</a>
    <a href="bio.html">Bio</a>
    <a href="merch.html" aria-current="page">Merch</a>
    <a href="mailto:deadgravell77@gmail.com">Contact</a>
  </div>

  <main>
    <div class="top-pad" aria-hidden="true"></div>

    <!-- Header -->
    <section id="header">
      <div class="section-inner backdrop-none">
        <div class="kicker">Official Store</div>
        <h2 class="brand">Dead Gravel Merch</h2>
        <div class="rule"></div>

        <p class="product-desc" style="text-align:center; margin-inline:auto; max-width:60ch;">
          Welcome to the <strong>Dead Gravel</strong> store. Prices include flat-rate EU shipping.
          For shipping outside the EU, <a href="mailto:deadgravel77@gmail.com">email us</a>.
          Check out with <strong>Stripe</strong> (cards, Apple&nbsp;Pay, Google&nbsp;Pay, <strong>MB&nbsp;WAY</strong>) or <strong>PayPal</strong>.
        </p>
      </div>
    </section>

    <!-- Merch -->
    <section id="merch">
      <div class="section-inner grid-merch">

        <!-- Product 1: Dustborn Shirt (Yellow default) -->
        <article class="product-card"
                 data-id="tee-dustborn"
                 data-name="Dustborn Shirt"
                 data-price="21.99"
                 data-currency="EUR"
                 data-sizes="S:12,M:8,L:0,XL:6,XXL:2"
                 data-colors="Yellow:merch1-yellow.jpeg,Black:merch1-black.jpeg,White:merch1-white.jpeg"
                 data-default-color="Yellow"
                 data-selected-color="">
          <img src="merch1-yellow.jpeg" alt="Dustborn Shirt â€” Yellow" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Dustborn Shirt</h3>
          <p class="product-desc">Premium cotton, unisex. Sizes Sâ€“XXL.</p>
          <div class="product-price">â‚¬21.99</div>

          <div class="size-slot"></div>

          <div class="color-inline">
            <span class="color-label-inline">Color</span>
            <div class="swatch-row-inline"></div>
            <div class="help-note">Click a color or tap the image to open the preview.</div>
          </div>

          <div class="btn-row">
            <a class="btn btn-primary checkout-link"
               href="https://buy.stripe.com/dRm28j59dbKCdSF4wI8EM00"
               target="_blank" rel="noopener">Checkout</a>
          </div>

          <!-- overlay gets injected by JS when disabled -->
        </article>

        <!-- Product 2: Totebag (Natural default, one size) -->
        <article class="product-card"
                 data-id="totebag-classic"
                 data-name="Totebag"
                 data-price="14.99"
                 data-currency="EUR"
                 data-sizes="One Size:25"
                 data-colors="Natural:merch2-natural.png,Black:merch2-black.png,White:merch2-white.png"
                 data-default-color="Natural"
                 data-selected-color="">
          <img src="merch2-white.png" alt="Totebag â€” Natural" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Dustborn Totebag</h3>
          <p class="product-desc">Sturdy cotton tote. One size.</p>
          <div class="product-price">â‚¬14.99</div>

          <div class="size-slot"></div>

          <div class="color-inline">
            <span class="color-label-inline">Color</span>
            <div class="swatch-row-inline"></div>
            <div class="help-note">Click a color or tap the image to open the preview.</div>
          </div>

          <div class="btn-row">
            <a class="btn btn-primary checkout-link"
               href="https://buy.stripe.com/dRm28j59dbKCdSF4wI8EM00"
               target="_blank" rel="noopener">Checkout</a>
          </div>
        </article>

        <!-- Product 3: Longsleeve Shirt (Black default) -->
        <article class="product-card"
                 data-id="tee-longsleeve"
                 data-name="Longsleeve Shirt"
                 data-price="29.99"
                 data-currency="EUR"
                 data-sizes="S:0,M:7,L:7,XL:7,XXL:1"
                 data-colors="Black:merch3-black.jpeg,White:merch3-white.jpeg,Pink:merch3-pink.jpeg"
                 data-default-color="Black"
                 data-selected-color="">
          <img src="merch3-black.jpeg" alt="Longsleeve Shirt â€” Black" class="product-media" loading="lazy" decoding="async">
          <h3 class="product-title">Dead Gravel Longsleeve Shirt</h3>
          <p class="product-desc">Soft heavyweight cotton, ribbed cuffs.</p>
          <div class="product-price">â‚¬29.99</div>

          <div class="size-slot"></div>

          <div class="color-inline">
            <span class="color-label-inline">Color</span>
            <div class="swatch-row-inline"></div>
            <div class="help-note">Click a color or tap the image to open the preview.</div>
          </div>

          <div class="btn-row">
            <a class="btn btn-primary checkout-link"
               href="https://buy.stripe.com/dRm28j59dbKCdSF4wI8EM00"
               target="_blank" rel="noopener">Checkout</a>
          </div>
        </article>

      </div>

      <!-- ðŸ“£ Coming Soon banner (appears when store disabled) -->
      <div id="comingSoonBanner" class="section-inner" style="margin-top:22px; display:none;">
        <div class="coming-soon">
          <div><strong>Merch Coming Soon</strong></div>
          <div class="sub">Weâ€™re polishing a few things. Check back soon or <a href="mailto:deadgravel77@gmail.com">email us</a> for updates.</div>
        </div>
      </div>
    </section>

    <!-- Gravilhas -->
    <section id="gravilhas" class="link-wrap">
      <div class="section-inner backdrop-none">
        <img src="gravilhas4.svg" alt="gravilhas" class="gravilhas" loading="lazy" decoding="async" />
        <a class="full-link" href="index.html" aria-label="Go to homepage"></a>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="rights">Â© <span id="year"></span> Dead Gravel â€” All rights reserved.</div>

      <div class="socials" role="list" aria-label="Social links">
        <a aria-label="Instagram" href="https://instagram.com/deadgravel77" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor"/>
            <circle cx="12" cy="12" r="4" stroke="currentColor"/>
            <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="Bandcamp" href="https://deadgravel.bandcamp.com/track/ruin-my-fun" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 17l5.5-10H21l-5.5 10H3z" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="YouTube" href="https://www.youtube.com/@DeadGravel77" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor"/>
            <path d="M10 9.5l5 2.5-5 2.5v-5z" fill="currentColor"/>
          </svg>
        </a>
        <a aria-label="Spotify" href="#" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="9" stroke="currentColor"/>
            <path d="M7 10c3-.6 7-.4 10 1M7.5 13c2.6-.4 5.8-.1 8 .9M7.8 15.8c1.9-.3 3.9 0 5.6 .7" stroke="currentColor" stroke-linecap="round"/>
          </svg>
        </a>
      </div>
    </footer>
  </main>

  <script>
    // Year
    (function(){
      const y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();
    })();

    // Scroll effects
    (function initScrollEffects(){
      const shade = document.getElementById('bgShade');
      const nav   = document.getElementById('topLinks');
      if (!shade || !nav) return;
      const mqMobileNav = window.matchMedia('(max-width: 640px)');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const maxOpacity = 0.75;
      const rampPx = 220;
      let ticking = false;
      function apply(){
        const y = window.scrollY || 0;
        shade.style.opacity = (prefersReduced ? (y>0?'0.5':'0') : (Math.min(1,y/rampPx)*maxOpacity).toFixed(3));
        if (mqMobileNav.matches) nav.classList.remove('hide');
        else nav.classList.toggle('hide', y > 40);
        ticking = false;
      }
      function onScroll(){ if (!ticking) { ticking = true; requestAnimationFrame(apply); } }
      apply();
      window.addEventListener('scroll', onScroll, { passive:true });
      window.addEventListener('resize', apply, { passive:true });
      mqMobileNav.addEventListener?.('change', apply);
    })();

    // Mobile hamburger
    (function(){
      const btn  = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;
      const lock = (on) => { document.body.style.overflow = on ? 'hidden' : ''; };
      const open = () => { menu.hidden = false; void menu.offsetHeight; menu.classList.add('open'); btn.setAttribute('aria-expanded','true'); btn.setAttribute('aria-label','Close menu'); lock(true); };
      const close = () => { menu.classList.remove('open'); btn.setAttribute('aria-expanded','false'); btn.setAttribute('aria-label','Open menu'); lock(false); setTimeout(() => { if (!menu.classList.contains('open')) menu.hidden = true; }, 260); };
      btn.addEventListener('click', () => (menu.classList.contains('open') ? close() : open()));
      menu.addEventListener('click', (e) => { if (e.target.closest('a')) close(); });
      window.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
      window.addEventListener('resize', () => { if (!window.matchMedia('(max-width: 640px)').matches) close(); }, { passive:true });
    })();

    // --- Build size dropdown (stock-aware) ---
    function buildSizeDropdown(card){
      const slot = card.querySelector('.size-slot');
      if(!slot) return;
      const raw = (card.dataset.sizes || '').trim();
      const pairs = raw.split(',').map(s => s.trim()).filter(Boolean);

      const select = document.createElement('select');
      select.name = 'variant';
      select.required = true;
      select.className = 'ship-input';
      select.setAttribute('aria-label','Choose size');

      const ph = document.createElement('option');
      ph.value = '';
      ph.textContent = 'Select size';
      ph.disabled = true;
      ph.selected = true;
      select.appendChild(ph);

      pairs.forEach(p => {
        const [size, qtyStr] = p.split(':').map(x => x.trim());
        const qty = Number(qtyStr);
        if(!size) return;
        const opt = document.createElement('option');
        opt.value = size;
        if(isFinite(qty)){
          if(qty > 0){
            opt.textContent = `${size} â€” ${qty} in stock`;
          }else{
            opt.textContent = `${size} â€” Out of stock`;
            opt.disabled = true;
            opt.className = 'oos';
          }
        }else{
          opt.textContent = size;
        }
        select.appendChild(opt);
      });

      slot.innerHTML = '';
      slot.appendChild(select);
    }

    // Parse color map from data attribute
    function parseColorMap(card){
      const map = {};
      (card.dataset.colors || '')
        .split(',').map(s=>s.trim()).filter(Boolean)
        .forEach(pair=>{
          const [label, url] = pair.split(':').map(x=>x.trim());
          if(label && url) map[label] = url;
        });
      return map;
    }

    // Update card image & selection
    function updateCardImage(card, label){
      const colors = parseColorMap(card);
      const url = colors[label];
      const img = card.querySelector('.product-media');
      if(img && url){
        img.src = url;
        img.alt = `${card.dataset.name} â€” ${label}`;
      }
      card.dataset.selectedColor = label;

      // Sync inline swatch selection state
      const row = card.querySelector('.swatch-row-inline');
      if(row){
        row.querySelectorAll('.swatch-btn').forEach(btn=>{
          const sel = btn.dataset.color === label;
          btn.dataset.selected = sel ? 'true' : 'false';
          btn.setAttribute('aria-pressed', sel ? 'true' : 'false');
        });
      }
      // If modal open for this card, sync its swatches & preview too
      if(modalCard === card){
        const b = Array.from(swatchRow.children).find(el=>el.dataset.color === label);
        if(b){
          swatchRow.querySelectorAll('.swatch').forEach(el=>{
            const sel = el === b;
            el.dataset.selected = sel ? 'true' : 'false';
            el.setAttribute('aria-pressed', sel ? 'true' : 'false');
          });
        }
        previewImg.src = url;
        previewImg.alt = `${card.dataset.name} â€” ${label}`;
        resetZoom();
      }
    }

    // Init default product image & selected color
    function initDefaultColor(card){
      const colors = parseColorMap(card);
      const def = (card.dataset.defaultColor || '').trim();
      const start = colors[def] ? def : Object.keys(colors)[0];
      if(start){
        card.dataset.selectedColor = start;
        const url = colors[start];
        const img = card.querySelector('.product-media');
        if (img && url){
          img.src = url;
          img.alt = `${card.dataset.name} â€” ${start}`;
        }
      }
    }

    // Build inline swatches inside each card
    function buildInlineSwatches(card){
      const row = card.querySelector('.swatch-row-inline');
      if(!row) return;
      row.innerHTML = '';
      const colors = parseColorMap(card);
      const current = card.dataset.selectedColor || card.dataset.defaultColor || Object.keys(colors)[0];

      Object.entries(colors).forEach(([label])=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'swatch-btn';
        b.dataset.color = label;
        b.textContent = label;
        b.setAttribute('aria-pressed', label === current ? 'true' : 'false');
        b.dataset.selected = label === current ? 'true' : 'false';
        b.addEventListener('click', ()=>{ updateCardImage(card, label); });
        row.appendChild(b);
      });
    }

    // -------- Shared Color Modal (opens via thumbnail click) + Zoom/Pan --------
    const colorModal = document.createElement('div');
    colorModal.className = 'modal';
    colorModal.innerHTML = `
      <div class="modal-dialog" role="dialog" aria-modal="true" aria-label="Choose color">
        <div class="modal-header">
          <span class="modal-title">Preview Colors</span>
          <button class="modal-close" type="button">Close</button>
        </div>
        <div class="modal-body">
          <div class="modal-preview"><img alt="Preview" /></div>
          <div class="color-group">
            <label class="color-label">Available colors</label>
            <div class="swatch-row" id="swatchRow"></div>
            <p class="help-note">Click image to zoom. Drag to pan while zoomed.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" id="cancelBtn">Close</button>
        </div>
      </div>
    `;
    document.body.appendChild(colorModal);
    const swatchRow   = colorModal.querySelector('#swatchRow');
    const previewImg  = colorModal.querySelector('.modal-body img');
    const closeModalBtn = colorModal.querySelector('.modal-close');
    const cancelBtn     = colorModal.querySelector('#cancelBtn');
    const previewBox    = colorModal.querySelector('.modal-preview');

    let modalCard = null;

    function openColorModal(card){
      modalCard = card;
      const colors = parseColorMap(card);
      const current = card.dataset.selectedColor || card.dataset.defaultColor || Object.keys(colors)[0];

      // Build swatches (modal)
      swatchRow.innerHTML = '';
      Object.entries(colors).forEach(([label])=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'swatch';
        b.dataset.color = label;
        b.textContent = label;
        b.setAttribute('aria-pressed','false');
        b.addEventListener('click', ()=>{ updateCardImage(card, label); });
        swatchRow.appendChild(b);
      });

      // Prime current preview
      const curUrl = colors[current];
      previewImg.src = curUrl;
      previewImg.alt = `${card.dataset.name} â€” ${current}`;
      Array.from(swatchRow.children).forEach(el=>{
        const sel = el.dataset.color === current;
        el.dataset.selected = sel ? 'true' : 'false';
        el.setAttribute('aria-pressed', sel ? 'true' : 'false');
      });

      resetZoom();
      colorModal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeColorModal(){
      colorModal.classList.remove('open');
      document.body.style.overflow = '';
      resetZoom();
      modalCard = null;
    }
    closeColorModalBtn = closeColorModal; // keeps reference for disabled mode
    closeModalBtn.addEventListener('click', closeColorModal);
    cancelBtn.addEventListener('click', closeColorModal);
    colorModal.addEventListener('click', (e)=>{ if (e.target === colorModal) closeColorModal(); });
    window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && colorModal.classList.contains('open')) closeColorModal(); });

    // --- Zoom/Pan with Pointer Events (stable on mobile) ---
    let zoomed = false;
    let offset = { x:0, y:0 };
    let dragging = false;
    let dragStart = { x:0, y:0 };
    let dragMoved = false; // to distinguish tap vs drag
    const SCALE = 2;

    function applyTransform(){
      previewImg.style.transform = `translate(${offset.x}px, ${offset.y}px) scale(${zoomed ? SCALE : 1})`;
    }

    function resetZoom(){
      zoomed = false; dragging = false; offset = { x:0, y:0 }; dragMoved = false;
      previewImg.classList.remove('zoomed');
      previewImg.style.transform = 'translate(0,0) scale(1)';
      previewImg.style.cursor = 'zoom-in';
    }

    function clampPan(){
      const box = previewBox.getBoundingClientRect();
      const extraW = (box.width  * (SCALE - 1)) / 2;
      const extraH = (box.height * (SCALE - 1)) / 2;
      offset.x = Math.max(-extraW, Math.min(extraW, offset.x));
      offset.y = Math.max(-extraH, Math.min(extraH, offset.y));
    }

    function toggleZoomCentered(){
      if(!zoomed){
        zoomed = true;
        offset = { x:0, y:0 };
        previewImg.classList.add('zoomed');
        previewImg.style.cursor = 'grab';
        clampPan(); applyTransform();
      }else{
        resetZoom();
      }
    }

    previewImg.addEventListener('pointerdown', (e)=>{
      if(zoomed){
        dragging = true; dragMoved = false;
        previewImg.setPointerCapture(e.pointerId);
        previewImg.style.cursor = 'grabbing';
        dragStart = { x:e.clientX - offset.x, y:e.clientY - offset.y };
        e.preventDefault();
      }
    });

    previewImg.addEventListener('pointermove', (e)=>{
      if(!dragging || !zoomed) return;
      const nx = e.clientX - dragStart.x;
      const ny = e.clientY - dragStart.y;
      if(Math.abs(nx - offset.x) > 0.5 || Math.abs(ny - offset.y) > 0.5){ dragMoved = true; }
      offset.x = nx; offset.y = ny;
      clampPan(); applyTransform();
      e.preventDefault();
    });

    function endPointer(e){
      if(!zoomed) return;
      if(dragging){
        previewImg.releasePointerCapture?.(e.pointerId);
        previewImg.style.cursor = 'grab';
        dragging = false;
        if(!dragMoved){ toggleZoomCentered(); }
      }else{
        toggleZoomCentered();
      }
    }
    previewImg.addEventListener('pointerup', endPointer);
    previewImg.addEventListener('pointercancel', endPointer);
    previewImg.addEventListener('click', (e)=>{ if(!dragMoved && !dragging) toggleZoomCentered(); });

    function attachImageModal(card){
      const img = card.querySelector('.product-media');
      if(!img) return;
      img.addEventListener('click', ()=> openColorModal(card));
    }

    // -------- Email helpers (seller-only pre-checkout note) --------
    function getSelection(card){
      const sizeSel = card.querySelector('select[name="variant"]');
      return {
        variant: sizeSel?.value || '',
        color: card.dataset.selectedColor || card.dataset.defaultColor || ''
      };
    }

    async function sendSellerEmail({card}){
      const name  = card.dataset.name;
      const price = card.dataset.price;
      const currency = card.dataset.currency || 'EUR';
      const id = card.dataset.id;
      const { variant, color } = getSelection(card);

      if(!variant || !color){
        alert('Please choose a size and a color before checkout.');
        throw new Error('Missing variant/color');
      }

      const orderPayload = {
        product_id: id,
        product_name: name,
        price, currency,
        variant: variant,
        color: color,
        order_time: new Date().toISOString(),
        payment_method: 'Stripe Checkout (pre)'
      };

      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_TO_SELLER, orderPayload);
    }

    function toast(msg){
      const el = document.createElement('div');
      el.textContent = msg;
      Object.assign(el.style, {
        position:'fixed', left:'50%', top:'16px', transform:'translateX(-50%)',
        background:'#0e141d', color:'#e8e8e8', border:'1px solid #ffffff33',
        padding:'10px 14px', borderRadius:'999px', zIndex:999999, boxShadow:'0 12px 30px #000a'
      });
      document.body.appendChild(el); setTimeout(()=> el.remove(), 3400);
    }

    // Checkout handler (single button)
    (function(){
      document.querySelectorAll('.product-card .checkout-link').forEach(link=>{
        link.addEventListener('click', async (e)=>{
          const card = e.target.closest('.product-card');
          try{
            await sendSellerEmail({ card });
            toast('Got it. Taking you to secure checkoutâ€¦');
          }catch(err){
            e.preventDefault(); // stop leaving if invalid
            console.error('Pre-checkout email failed or missing selection', err);
            return;
          }
        }, { capture:true });
      });
    })();

    // Init all cards (sizes, default color, inline swatches, modal hook)
    (function(){
      document.querySelectorAll('.product-card').forEach(card => {
        buildSizeDropdown(card);
        initDefaultColor(card);
        buildInlineSwatches(card);
        attachImageModal(card);
      });
    })();

    // ðŸ”’ Apply "store paused" mode (no navigation, no modal, clear CTAs)
    (function(){
      if(!STORE_DISABLED) return;
      document.body.classList.add('store-disabled');

      // Turn on banner
      const banner = document.getElementById('comingSoonBanner');
      if (banner) banner.style.display = 'block';

      // For each product, add a faint overlay chip and neutralize interactions
      document.querySelectorAll('.product-card').forEach(card=>{
        // overlay chip
        const overlay = document.createElement('div');
        overlay.className = 'disabled-cover';
        overlay.setAttribute('aria-hidden','true');
        overlay.innerHTML = `<span class="disabled-chip">Coming Soon</span>`;
        card.appendChild(overlay);

        // disable selects & swatches for a11y
        card.querySelectorAll('select, button.swatch-btn, .swatch, .product-media').forEach(el=>{
          el.setAttribute('tabindex','-1');
          el.setAttribute('aria-disabled','true');
        });

        // replace checkout link text and block navigation
        const link = card.querySelector('.checkout-link');
        if(link){
          link.textContent = 'Coming Soon';
          link.setAttribute('aria-disabled','true');
          link.removeAttribute('href'); // ensure no accidental navigation
          link.addEventListener('click', (e)=>{ e.preventDefault(); e.stopImmediatePropagation(); });
        }
      });

      // prevent modal from ever opening
      document.querySelectorAll('.product-media').forEach(img=>{
        img.replaceWith(img.cloneNode(true)); // strip existing listeners
      });
      // if modal somehow open, close it
      if (document.querySelector('.modal.open')) { closeColorModal(); }
    })();
  </script>
</body>
</html>
